# Regular expressions {#regexps}

*Regular expressions*, *regexps* or *patterns*, are strings that describe classes of strings. E.g.
the regexp "Nrd[A-Z]" describes, or *matches*, the strings "NrdA", "NrdB", "NrdC" or any other
string that starts with "Nrd" and continues with a capital letter. Regexps are used to *search* for
strings and in tools that *modify* strings. 

There are two types of characters in regexps: regular characters and *metacharacters*. The former
makes up the majority and just matches itself; examples include letters, numbers, space and most
other characters. The latter, the metacharacters, are characters that matches something else than a
literal character. Two very common examples are `.` and `*`. The `.` matches not a literal character
but *any character*, whereas the `*` is a *multiplier* specifying that the character before it could
occur any number of times, including zero. A `.*` pattern hence means "match anything, any number of
times" (which is, of course, rather useless on its own, but is useful when mixed with other
characters).

If you want to search for a literal character, but the specific character, e.g. `.`, is a
metacharacter, you can escape it, usually by preceding it with a `\`. `\.` would hence match a
literal period. In some cases, particularly tools that are older than Perl, such as Grep, Awk and
Sed, there are missing metacharacters. To turn regular characters into metacharacters in these
cases, you have to *escape the regular character*. One example is `(` and `)` which are used in
Perl, and many other regexp engines, to "capture" what was matched for later use, but in standard
sed just means literal parentheses. To capture text and modify it with `sed` you could e.g. write
`s/Nrd\([A-Za-z]\)/Nrd\U\1/` (match "Nrd" followed by any letter and make the letter capital (`\U`:
upper case)). See also the grep alternation example in \@ref(grep)  below.

---------------------------------------------------------------------------------------------------
Metacharacter Meaning                   Examples                                Implemented in 
                                            
------------- ------------------------- --------------------------------------- -------------------
`.`           Match anything.                                                   All

`[a-z]`       Enumeration of characters `[a-z]` matches any small               All
              ("character class").      letter, `[a-zA-Z0-9]` any 
                                        letter or number.
                

`*`           Allow any number of the   `[a-z]*` matches any number             All
              character preceding.      of any small letter.

`?`           Allow one or zero of the  `[a-z]?` matches zero or one            All
              preceding pattern.        small letter.

`+`           At least one.             `[a-z]+` matches one or more            Perl, R. Grep and 
                                        small letters.                          Sed in escaped form.

`^`           Anchor pattern at the     `^NrdA` matches "NrdA" only if it's     All
              start of the line.        at the start of the line.

`$`           Anchor pattern at the     `NrdA$` matches "NrdA" only if it's     All
              end of the line.          at the end of the line.

`(n)`         Capture and group.        Capture for later use in a              Perl, R. Grep and 
                                        substitution (see Sed below)            Sed in escaped form.
                                        or group used with the                  
                                        alternation character `|`.

`|`           Alternation.              Match either what's before the pipe     Perl, R. Grep and
                                        or what comes after (usually in         Sed in escaped form.
                                        parentheses, i.e `(bike)|(boat)`.       

`&`           In *substitution*:        `s/(Nrd[A-Z])/&\t&/` duplicates the     All that have
              whatever was matched      match separated with a tab.             substitution: Perl,
                                                                                Sed, R.

`\1`          In *substitution*:        `s/.*(Nrd[A-Z])/\1/` strip off          All that have
              whatever was matched by   anything before "Nrdx". Up to nine      substitution.
              first set of parentheses. pairs of parentheses can be used.

---------------------------------------------------------------------------------------------------

Table: (\#tab:regexp-metacharacters) Common metacharacters used in regular expressions.

Below, a few tools that implement regexps are described.

## Grep {#grep}

The Grep program^[Supposedly, "grep" stands for "**G**lobally search a **R**egular **E**xpression
and **P**rint".] is a standard UNIX search tool commonly used on its own or in pipelines to search
for *lines* in files that contain a regexp. That Grep searches for lines instead of only the search
pattern -- unless you specify the `-o/--only-matching` option -- makes it a little bit different
than most other tools since you do not have to specify a complete, line-matching, pattern, but just a
piece that is sufficiently discriminating. Grep is a tool that is commonly used as a filter in
pipelines see \@ref(pipelines) and the examples below.

---------------------------------------------------------------------------------------------------
Options                 Meaning                 
----------------------- ---------------------------------------------------------------------------
-i/--ignore-case        Ignore case, i.e. look for matches disregarding capital/lower case.

-v/--invert-match       Invert match, i.e. output lines that do *not* match the pattern.

-c/--count              Count the number of matching lines.

-f FILE/--file=FILE     Search for patterns specified in FILE.

-l/--files-with-matches Output only the names of files containing at least one matching line.

---------------------------------------------------------------------------------------------------

Table: (\#tab:grep-options) Commonly used options in Grep. See the manual page for much more.

Some examples of how to use Grep:

```
# Search for a user named "dl" in the user database
grep dl /etc/passwd

# Search for RNR proteins in a fasta file containing NCBI's NR database
# (The quotes are not necessary, but a good habit to make sure regexps not
# mistakenly match file globs.)
grep "Nrd[ABDEFJ]" nr.faa

# Subset results to mouse and human, assuming the species name comes after the 
# protein name.
# This pattern uses *alternation* when looking for either mouse or human.
# (The parentheses and pipe are not metacharacters in grep, so we have to escape 
# them.)
grep "Nrd[ABDEFJ].*\(Mus musculus\)\|\(Homo sapiens\)" nr.faa

# If we're not certain that protein name comes before species, build a pipeline
grep "Nrd[ABDEFJ]" nr.faa | grep "\(Mus musculus\)\|\(Homo sapiens\)"
```

(The above describes Grep's *basic regular expression* mode (BRE), which is the default. There is
also an *extended regular expression* mode (ERE) which is available via the `-E` option.)

## Sed {#sed}

Sed^[Sed stands for **S**tream **ED**itor.] is a tool that uses regexps to modify text. The most
common way to use the program is to specify a substitution command that looks like
`s/regexp/replacement/` which is like a search (regexp) and replace (replacement) command, but more
powerful. In the replacement part, you can refer to the whole match (`&`) or parts of the match that
were captured with parentheses (`\1`). After the last `/` you can add modifiers; the most commonly
used is `g` (global) which does more than one replacement per line.

Like Grep, Sed is a very powerful pipeline tool.

Some examples of how to use Sed:

```
# Replace space with underscore characters:
sed "s/ /_/g" file > newfile

# If there sometimes are more than one space that you want to replace with a single underscore:
sed "s/ \+/_/g" file > newfile

# The -i option edits the file in place
sed -i "s/ \+/_/g" file > newfile
```

More help can be found at the [GNU sed home page](http://www.gnu.org/software/sed/) or by searching
the Internet.

## AWK {#awk-regexps}

AWK is a complete programming language with a feature complete regexp engine. Although not much used
for script writing anymore, it is a popular tool in pipelines. Since its regexp engine is rarely
seen in pipelines I'm skipping it here for now.

## Perl {#perl-regexps}

The Perl scripting language has meant more for the development of regexps than any other language
with the invention of several new useful concepts like metacharacters for predefined character
classes like numbers and whitespace. Since Perl unfortunately has lost most of its early user base
in computational biology, I'm not going to describe it here.

## R {#r-regexps}

```{r include=FALSE}
# vim:tw=100
```
